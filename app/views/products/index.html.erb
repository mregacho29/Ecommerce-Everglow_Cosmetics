<h1 class="d-flex justify-content-start my-4">Chosen For You</h1>

<div class="mb-3">
  <%= link_to "Show All Products", products_path, class: "btn btn-secondary" %>
  <%= link_to "On Sale (Below $50)", products_path(filter: "on_sale"), class: "btn btn-primary" %>
</div>

<div class="container">
  <div class="row">
    <% @products.each do |product| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <% if product.image_url.present? %>
            <img src="<%= product.image_url %>" class="card-img-top" alt="<%= product.name %>" style="height: 200px; object-fit: cover;">
          <% elsif product.image.attached? %>
            <%= image_tag url_for(product.image), class: "card-img-top", alt: product.name, style: "height: 200px; object-fit: cover;" %>
          <% else %>
            <%= image_tag "placeholder.png", class: "card-img-top", alt: "Default product image", style: "height: 200px; object-fit: cover;" %>
          <% end %>
          <div class="card-body">
            <h5 class="card-title"><%= product.name %></h5>
            <p class="card-text">Price: <%= number_to_currency(product.price) %></p>
            <p class="card-text">Stock: <%= product.stock_quantity %></p>

            <div class="d-flex flex-column gap-2 align-items-center">
              <%= link_to 'View Details', product_path(product), class: "btn btn-primary btn-sm" %>
              <%= form_with url: add_to_cart_path, method: :post, local: true, class: "d-inline-flex align-items-center justify-content-center" do |f| %>
                <%= f.hidden_field :product_id, value: product.id %>
                <%= f.number_field :quantity, value: 1, min: 1, class: "form-control form-control-sm w-50 me-2" %>
                <%= f.submit "Add", class: "btn btn-success btn-sm" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Pagination Links -->
<div class="d-flex justify-content-start">
  <%= paginate @products, theme: 'bootstrap-4' %>
</div>