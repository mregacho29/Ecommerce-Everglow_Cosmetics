<h1 class="d-flex justify-content-start my-4">Chosen For You</h1>

<div class="mb-3">
  <%= link_to "Show All Products", products_path, class: "btn btn-secondary" %>
  <%= link_to "On Sale (Below $50)", products_path(filter: "on_sale"), class: "btn btn-primary" %>
</div>

<div class="container">
  <div class="row">
    <% @products.each do |product| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <% if product.image_url.present? %>
            <img src="<%= product.image_url %>" class="card-img-top" alt="<%= product.name %>" style="height: 200px; object-fit: cover;">
          <% elsif product.image.attached? %>
            <%= image_tag url_for(product.image), class: "card-img-top", alt: product.name, style: "height: 200px; object-fit: cover;" %>
          <% else %>
            <img src="https://via.placeholder.com/200" class="card-img-top" alt="No image available" style="height: 200px; object-fit: cover;">
          <% end %>
          <div class="card-body">
            <h5 class="card-title"><%= product.name %></h5>
            <p class="card-text">Price: <%= number_to_currency(product.price) %></p>
            <p class="card-text">Stock: <%= product.stock_quantity %></p>
            <%= link_to 'View Details', product_path(product), class: "btn btn-primary mb-2" %>

            <!-- Add to Cart Button -->
            <%= form_with url: add_to_cart_path, method: :post, local: true do |f| %>
              <%= f.hidden_field :product_id, value: product.id %>
              <%= f.number_field :quantity, value: 1, min: 1, class: "form-control form-control-sm d-inline w-25 mb-2" %>
              <%= f.submit "Add to Cart", class: "btn btn-success" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Pagination Links -->
<div class="d-flex justify-content-start">
  <%= paginate @products, theme: 'bootstrap-4' %>
</div>